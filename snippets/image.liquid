{% doc %}
  Renders a responsive image that might be wrapped in a link.

  When `width`, `height` and `crop` are provided, the image will be rendered
  with a fixed aspect ratio.

  Serves as an example of how to use the `image_url` filter and `image_tag` filter
  as well as how you can use LiquidDoc to document your code.

  @param {image} image - The image to be rendered
  @param {string} [url] - Optional destination URL for the image
  @param {string} [class] - Optional class to be added to the image wrapper
  @param {string} [id] - Optional id for the image
  @param {string} [alt] - Alternative text for the image
  @param {number} [width] - Max width of the image
  @param {number} [height] - Max height of the image
  @param {string} [crop] - Crop position of the image
  @param {string} [loading] - Lazy/eager loading (default: lazy)
  @param {string} [decoding] - async/sync decoding (default: async)
  @param {string} [sizes] - Responsive sizes attribute
  @param {string} [fetchpriority]

  @example
  {% render 'image', image: product.featured_image %}
  {% render 'image', image: product.featured_image, url: product.url %}
  {% render 'image',
    image: product.featured_image,
    url: product.url,
    class: 'rounded-xl shadow',
    width: 1200,
    height: auto,
    crop: 'center',
    alt: product.title,
    sizes: '(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw'
    fetchpriority: 
  %}
{% enddoc %}

{% liquid
  assign final_width = width | default: 1200
  if height
    assign final_height = height
  else
    assign temp_height = final_width | times: image.height
    assign final_height = temp_height | divided_by: image.width
  endif

  if url
    assign wrapper = 'a'
  else
    assign wrapper = 'div'
  endif

  assign alt_text = alt | default: image.alt | escape
  assign loading_attr = loading | default: 'lazy'
  assign decoding_attr = decoding | default: 'async'
  assign fetchpriority_attr = fetchpriority | default: 'auto'
  assign sizes_attr = sizes | default: '(max-width: 768px) 100vw, 50vw'
%}

<{{ wrapper }}
  class="image relative overflow-hidden {{ class }}"
  {% if url %}
    href="{{ url }}"
  {% endif %}
>
  {{
    image
    | image_url: crop: crop
    | image_tag:
      id: id,
      class: 'w-full h-full object-cover',
      alt: alt_text,
      loading: loading_attr,
      decoding: decoding_attr,
      sizes: sizes_attr,
      fetchpriority: fetchpriority_attr,
      width: final_width,
      height: final_height
  }}
</{{ wrapper }}>
