<!-- RANDOM PRODUCT POPUP -->
<a
  id="corner-popup"
  class="fixed bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 w-80 max-w-xs cursor-pointer z-50 hidden"
>
  <!-- عنوان البوب أب -->
  <p class="text-sm text-gray-500 mb-2">{{ settings.random_product_popup_title }}</p>

  <!-- الصورة + المعلومات -->
  <div class="flex items-start gap-3">
    <!-- صورة المنتج -->
    <div class="w-20 h-20 flex-shrink-0">
      <img id="popup-product-image" src="" alt="Product" class="object-cover w-full h-full rounded" width="80" height="80">
    </div>

    <!-- معلومات المنتج -->
    <div class="flex-1 flex flex-col">
      <h3 id="popup-product-title" class="font-bold text-gray-800 mb-1 truncate"></h3>
      <p id="popup-product-description" class="text-gray-600 text-sm line-clamp-2"></p>
    </div>
  </div>

  <!-- الوقت -->
  <p class="text-xs text-gray-400 mt-3"><span id="popup-time">8 minutes ago</span> · view</p>

  <!-- النص الإضافي -->
  {% if settings.popup_random_product_content != blank %}
    <span class="block text-xs text-gray-500 mt-1">{{ settings.popup_random_product_content }}</span>
  {% endif %}
</a>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const products = {{ collections.all.products | json }};
    if (products.length === 0) return;

    const randomIndex = Math.floor(Math.random() * products.length);
    const product = products[randomIndex];

    const popup = document.getElementById('corner-popup');
    const imgEl = document.getElementById('popup-product-image');
    const titleEl = document.getElementById('popup-product-title');
    const descEl = document.getElementById('popup-product-description');
    const timeEl = document.getElementById('popup-time');

    console.log(product);

    // صورة المنتج
    if (product.featured_image) {
      imgEl.src = product.featured_image;
    } else {
      imgEl.src = '{{ "Luliz_Logo.png" | asset_url }}';
    }
    imgEl.alt = product.title;

    // عنوان + وصف
    titleEl.textContent = product.title;
    descEl.textContent = product.description 
      ? product.description.replace(/(<([^>]+)>)/gi, "").substring(0, 80) 
      : '';

    // وقت وهمي
    const minutesAgo = Math.floor(Math.random() * 9) + 2;
    timeEl.textContent = `${minutesAgo} minutes ago`;

    // إظهار البوب أب بعد ثانية
    setTimeout(() => popup.classList.remove('hidden'), 1000);

    // عند الضغط على البوب أب يفتح صفحة المنتج
    popup.setAttribute('href', product.url);
  });
</script>
