{%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}

<facet-filters-form class="facets facets-{{ filter_type }} page-width small-hide">
  <form
    id="FacetFiltersForm"
    class="facets-form"
    method="get"
    action="{{ collection.url }}"
    data-ajax-facets
    role="search"
    aria-label="{{ 'products.filters.filters' | t }}"
  >
    {%- if enable_sorting and filter_type == 'vertical' -%}
      <div class="facet-filters sorting caption">
        <div class="facet-filters__field">
          <h2 class="facet-filters__label caption-large text-body">
            <label for="SortBy">{{ 'products.facets.sort_by_label' | t }}</label>
          </h2>
          <div class="select">
            <select
              id="SortBy"
              name="sort_by"
              class="facet-filters__sort select__select caption-large"
              aria-describedby="a11y-refresh-page-message"
            >
              {%- for option in collection.sort_options -%}
                <option
                  value="{{ option.value | escape }}"
                  {% if option.value == sort_by %}selected="selected"{% endif %}
                >
                  {{ option.name | escape }}
                </option>
              {%- endfor -%}
            </select>
            <span class="svg-wrapper">
              {{- 'icon-caret.svg' | inline_asset_content -}}
            </span>
          </div>
        </div>
      </div>
    {%- endif -%}

    {%- if enable_filtering -%}
      {%- for facet in results.filters -%}
        <div class="facet-filters caption">
          <h3 class="facet-filters__label caption-large text-body">
            {{ facet.name }}
          </h3>
          <ul class="facet-filters__list">
            {%- for item in facet.items -%}
              <li class="facet-filters__item">
                <label>
                  <input
                    type="checkbox"
                    name="{{ facet.param }}"
                    value="{{ item.value }}"
                    {% if item.active %}checked{% endif %}
                    aria-checked="{{ item.active | json }}"
                  />
                  <span class="facet-filters__item-label">
                    {{ item.label }} ({{ item.count }})
                  </span>
                </label>
              </li>
            {%- endfor -%}
          </ul>
        </div>
      {%- endfor -%}
    {%- endif -%}

    <button type="submit" class="button button--primary mt-4">
      {{ 'products.filters.apply_filters' | t }}
    </button>

    <p
      id="a11y-refresh-page-message"
      class="visually-hidden"
      aria-live="polite"
      aria-atomic="true"
    >
      {{ 'products.filters.page_refresh_message' | t }}
    </p>
  </form>
</facet-filters-form>
