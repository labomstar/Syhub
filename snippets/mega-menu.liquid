<!-- Mega Menu -->
<div
  id="header-menu-{{ link.title | handleize }}"
  class="absolute top-full left-0 w-screen mt-3 hidden bg-white shadow-lg z-50"
  style="transition: all 0.2s ease-in-out;"
>
  <div class="max-w-screen-xl mx-auto px-4">
    <ul class="grid grid-cols-4 gap-4 py-4">
      {% for childlink in link.links %}
        <li class="relative group">
          <!-- Parent link -->
          <a
            href="{{ childlink.url }}"
            class="flex items-center justify-between px-4 py-2 text-sm font-medium hover:bg-gray-100 js-toggle-grandchild"
            aria-expanded="false"
          >
            <div class="flex items-center gap-x-2">
              {% if childlink.object.featured_image %}
                <img
                  src="{{ childlink.object.featured_image | img_url: '50x50' }}"
                  alt="{{ childlink.title }}"
                  class="w-5 h-5 object-cover rounded"
                  width=""
                  height=""
                >
              {% endif %}
              {{ childlink.title }}
            </div>
            {% if childlink.links != blank %}
              {% render 'icon-chevron-down' %}
            {% endif %}
          </a>

          {% if childlink.links != blank %}
            <ul class="absolute top-full left-0 hidden w-64 bg-white border border-gray-200 shadow-lg py-2 group-hover:block">
              {% for grandchild in childlink.links %}
                <li>
                  <a
                    href="{{ grandchild.url }}"
                    class="flex items-center gap-x-2 px-4 py-2 text-xs hover:bg-gray-100 whitespace-nowrap"
                  >
                    {% if grandchild.object.featured_image %}
                      <img
                        src="{{ grandchild.object.featured_image | img_url: '50x50' }}"
                        alt="{{ grandchild.title }}"
                        class="w-4 h-4 object-cover rounded"
                        width=""
                        height=""
                      >
                    {% endif %}
                    {{ grandchild.title }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</div>
