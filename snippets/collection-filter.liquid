<div class="filters space-y-4">
  <!-- Filter Selected Tags (Active Filters) -->
  {% if collection.current_tags.size > 0 or collection.current_filters.size > 0 %}
    <div class="mb-4 flex flex-wrap gap-2">
      {% for tag in collection.current_tags %}
        <span class="px-3 py-1 rounded bg-gray-200 text-sm flex items-center gap-2">
          {{ tag }}
          <a
            href="{{ collection.url | remove: '?constraint=' | append: collection.current_tags | split: tag | join: '' }}"
            class="text-red-500 hover:underline"
            >Ã—</a
          >
        </span>
      {% endfor %}
      <a href="{{ collection.url }}" class="text-sm text-indigo-600 hover:underline ml-2">Remove all</a>
    </div>
  {% endif %}

  <!-- Filter by Price Range -->
  <button onclick="togglePriceIcon(this)" class="bg-gray-100 w-full px-4 py-2 flex justify-between items-center">
    <span>Price</span>
    <div>
      <span class="icon-down block">{%- render 'icon-chevron-down' -%}</span>
      <span class="icon-up hidden">{%- render 'icon-chevron-up' -%}</span>
    </div>
  </button>
  <div x-data="priceFilter()" class="relative hidden items-center gap-x-3 bg-gray-100 px-4 py-2 rounded shadow-sm">
    <label class="block text-sm mb-2 font-semibold">from</label>
    <input
      type="number"
      x-model="minPrice"
      placeholder="from"
      class="w-full mb-3 px-3 py-2 border rounded"
      min="0"
      @keyup.enter="applyFilter"
    >

    <label class="block text-sm mb-2 font-semibold">to</label>
    <input
      type="number"
      x-model="maxPrice"
      placeholder="to"
      class="w-full mb-3 px-3 py-2 border rounded"
      min="0"
      @keyup.enter="applyFilter"
    >
  </div>

  <!-- Filter by Options -->
  {% for option in collection.all_types_options %}
    <div x-data="{ open: false }" class="relative">
      <button @click="open = !open" class="flex justify-between w-full px-4 py-2 bg-gray-100 rounded shadow-sm">
        {{ option.name }}
        <svg
          :class="{ 'rotate-180': open }"
          class="w-4 h-4 transition-transform"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <ul
        x-show="open"
        @click.away="open = false"
        class="absolute z-10 bg-white shadow rounded mt-1 w-full max-h-60 overflow-auto"
      >
        {% for value in option.values %}
          <li>
            <a
              href="{{ collection.url }}?options[{{ option.name | handle }}]={{ value | handle }}"
              class="block px-4 py-2 hover:bg-indigo-100"
            >
              {{ value }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endfor %}
</div>

<script>
function togglePriceIcon(button) {
  const iconDown = button.querySelector('.icon-down');
  const iconUp = button.querySelector('.icon-up');

  iconDown.classList.toggle('hidden');
  iconUp.classList.toggle('hidden');
}
</script>

<script>
  function priceFilter() {
    return {
      minPrice: '',
      maxPrice: '',
      applyFilter() {
        let url = new URL(window.location.href);

        if (this.minPrice) {
          url.searchParams.set('filter.v.price.gte', this.minPrice);
        } else {
          url.searchParams.delete('filter.v.price.gte');
        }

        if (this.maxPrice) {
          url.searchParams.set('filter.v.price.lte', this.maxPrice);
        } else {
          url.searchParams.delete('filter.v.price.lte');
        }

        window.location.href = url.toString();
      },
    };
  }
</script>
