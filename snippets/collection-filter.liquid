<div id="collection-filters" class="space-y-4">
  <div>
    <h3 class="font-semibold mb-2">Filter</h3>
    <label class="flex items-center gap-2">
      <input type="checkbox" name="filter.p.available" value="1" class="filter-input">
      In stock
    </label>
  </div>

  <div>
    <h3 class="font-semibold mb-2">Brand</h3>
    {% assign vendors = collection.all_vendors | sort %}
    {% for vendor in vendors %}
      <label class="flex items-center gap-2">
        <input type="checkbox" name="filter.v.vendor" value="{{ vendor | escape }}" class="filter-input">
        {{ vendor }}
      </label>
    {% endfor %}
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const filters = document.querySelectorAll(".filter-input");

  filters.forEach(input => {
    input.addEventListener("change", () => {
      let params = new URLSearchParams(window.location.search);

      // حذف الفلتر السابق لنفس النوع
      params.delete(input.name);

      if (input.checked) {
        params.append(input.name, input.value);
      }

      fetch(window.location.pathname + "?" + params.toString() + "&view=ajax")
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");
          const newGrid = doc.querySelector("#collection-grid");
          document.querySelector("#collection-grid").innerHTML = newGrid.innerHTML;
        });
    });
  });
});
</script>
