{{ 'component-facets.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}

{%- if section.settings.image_shape == 'blob' -%}
  {{ 'mask-blobs.css' | asset_url | stylesheet_tag }}
{%- endif -%}

{%- unless section.settings.quick_add == 'none' -%}
  {{ 'quick-add.css' | asset_url | stylesheet_tag }}
{%- endunless -%}

{%- if section.settings.quick_add == 'standard' -%}
  <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{%- if section.settings.quick_add == 'bulk' -%}
  <script src="{{ 'quick-add-bulk.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'quantity-popover.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'price-per-item.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'quick-order-list.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

<div class="px-6 py-12 max-w-7xl mx-auto">
  <div class="text-center mb-12">
    <a href="{{ routes.collections_url }}" class="text-sm text-gray-400 hover:text-gray-600 transition"
      >← Back To Collections</a
    >
    <h1 class="text-4xl font-extrabold text-gray-900 mt-4 tracking-tight">{{ collection.title }}</h1>
    <p class="text-gray-600 mt-2">Discover our exclusive selection of products</p>
  </div>

  <div class="flex gap-8">
    <!-- Filter Sidebar -->
    {% if section.settings.enable_filtering or section.settings.enable_sorting %}
      <aside
        class="w-1/5 sticky top-24 max-h-[calc(100vh-6rem)] overflow-y-auto bg-white p-6 rounded-lg shadow-md facets-wrapper{% unless section.settings.enable_filtering %} facets-wrapper--no-filters{% endunless %}{% if section.settings.filter_type != 'vertical' %} page-width{% endif %}"
        aria-labelledby="verticalTitle"
        id="main-collection-filters"
        data-id="{{ section.id }}"
      >
        {% render 'facets',
          results: collection,
          enable_filtering: section.settings.enable_filtering,
          enable_sorting: section.settings.enable_sorting,
          filter_type: section.settings.filter_type,
          paginate: paginate
        %}
      </aside>
    {% endif %}

    <!-- Products Grid -->
    <section class="w-4/5">
      {% paginate collection.products by section.settings.number_of_products_per_page %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
          {% assign skip_card_product_styles = false %}
          {% for product in collection.products %}
            {% if forloop.index > 2 %}
              {% assign lazy_load = true %}
              <div
                class="grid__item{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                {% if settings.animations_reveal_on_scroll %}
                  data-cascade
                  style="--animation-order: {{ forloop.index }};"
                {% endif %}
              >
                {% render 'product-card',
                  card_product: product,
                  lazy_load: lazy_load,
                  skip_styles: skip_card_product_styles,
                  quick_add: section.settings.quick_add,
                  section_id: section.id
                %}
              </div>
              {% assign skip_card_product_styles = true %}
            {% else %}
              {% assign lazy_load = false %}
              <p class="text-center text-gray-500 col-span-full py-10">لا توجد منتجات تطابق الفلاتر المحددة.</p>
            {% endif %}
          {% endfor %}
        </div>

        <div class="mt-12 flex justify-center">
          {% render 'pagination', paginate: paginate %}
        </div>
      {% endpaginate %}
    </section>
  </div>
</div>

{% schema %}
{
  "name": "Template Collection with Filters & Sorting",
  "settings": [
    {
      "type": "number",
      "id": "number_of_products_per_page",
      "label": "Number Of Products Per Page",
      "default": 16
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Enable Filtering",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable Sorting",
      "default": true
    },
    {
      "type": "select",
      "id": "filter_type",
      "label": "Filter Type",
      "default": "vertical",
      "options": [
        { "value": "vertical", "label": "Vertical" },
        { "value": "horizontal", "label": "Horizontal" },
        { "value": "drawer", "label": "Drawer" }
      ]
    },
    {
      "type": "select",
      "id": "quick_add",
      "label": "Quick Add Type",
      "default": "none",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "standard", "label": "Standard" },
        { "value": "bulk", "label": "Bulk" }
      ]
    }
  ]
}
{% endschema %}
