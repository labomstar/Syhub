<div class="recently-viewed max-w-7xl mx-auto py-8">
  <h2 class="text-2xl font-bold mb-4">Recently Viewed</h2>
  <div id="recently-viewed-products" class="grid grid-cols-2 md:grid-cols-4 gap-6"></div>
</div>

<script src="{{ 'recently-viewed.js' | asset_url }}" defer></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    let viewedProducts = JSON.parse(localStorage.getItem('recentlyViewed')) || [];

    if (viewedProducts.length > 0) {
      let container = document.getElementById('recently-viewed-products');

      // إزالة التكرارات
      let uniqueProducts = [...new Set(viewedProducts)];

      // عرض فقط آخر 6 منتجات
      uniqueProducts.slice(0, 6).forEach(function (handle) {
        fetch(`/products/${handle}.js`)
          .then((response) => response.json())
          .then((product) => {
            const productHtml = `
            <div class="product-card border p-4">
              <a href="/products/${product.handle}">
                <img src="${product.images[0]}" alt="${product.title}" class="w-full mb-2"/>
                <h3 class="text-lg font-semibold mb-1">${product.title}</h3>
                <p class="text-gray-700">${(product.price / 100).toFixed(2)} USD</p>
              </a>
            </div>
          `;
            container.insertAdjacentHTML('beforeend', productHtml);
          })
          .catch((err) => console.error('Error fetching product:', handle, err));
      });
    } else {
      // إخفاء السكشن إذا ما في منتجات
      document.querySelector('.recently-viewed').style.display = 'none';
    }
  });
</script>

{% schema %}
{
  "name": "Recently Viewed Products",
  "settings": [],
  "presets": [
    {
      "name": "Recently Viewed",
      "category": "Products"
    }
  ]
}
{% endschema %}
