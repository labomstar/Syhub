{% doc %}
  Renders a text block.

  @example
  {% content_for 'block', type: 'tools', id: 'tools' %}
{% enddoc %}

<div class="flex items-center gap-2" {{ block.shopify_attributes }}>
  {% form 'localization' %}
    <div class="flex items-center gap-2">
      <div class="flex justify-end xl:w-fit w-1/2">
        <ul class="flex items-center">
          <li class="ml-2 lg:mx-4 relative inline-block">
            <div class="relative">
              <button class="p-0 m-0 flex items-center" id="language-toggle" type="button">
                <span id="selected-language" class="mx-1">{{ localization.language.iso_code | upcase }}</span>
              </button>
              <div
                class="fixed lg:start-auto lg:left-0 lg:-translate-x-1/2 mt-2 w-48 bg-white rounded shadow-lg hidden text-start"
                id="language-menu"
                dir="{% if localization.language.iso_code == 'ar' %} rtl {% else %} ltr {% endif %}"
              >
                <ul class="py-1">
                  {% form 'localization', class: 'localization-form' %}
                    {% for language in localization.available_languages %}
                      <li>
                        <a
                          class="block px-4 py-2 text-gray-800 hover:bg-gray-200 language-option"
                          href="{{ language.root_url }}"
                          lang="{{ language.iso_code }}"
                          data-value="{{ language.iso_code }}"
                          {% if language.iso_code == localization.language.iso_code %}
                            aria-current="true" class="active"
                          {% endif %}
                        >
                          {{ language.endonym_name }}
                          {{ language.iso_code }}
                        </a>
                      </li>
                    {% endfor %}
                  {% endform %}
                </ul>
              </div>
            </div>
          </li>
        </ul>
      </div>

      <select
        name="country_code"
        class="mr-2 px-2 py-1 rounded max-w-fit"
        onchange="this.form.submit()"
      >
        {% for country in form.available_countries %}
          <option
            value="{{ country.iso_code }}"
            {% if country.iso_code == form.country.iso_code %}
              selected
            {% endif %}
          >
            {{- country.name }} |
            {{ country.currency.iso_code }}
            {{ country.currency.symbol -}}
          </option>
        {% endfor %}
      </select>
    </div>
  {% endform %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleButton = document.getElementById('language-toggle');
    const menu = document.getElementById('language-menu');

    if (toggleButton && menu) {
      toggleButton.addEventListener('click', function () {
        menu.classList.toggle('hidden');
      });

      // إغلاق القائمة عند النقر خارجها
      document.addEventListener('click', function (e) {
        if (!menu.contains(e.target) && !toggleButton.contains(e.target)) {
          menu.classList.add('hidden');
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "language currency block",
  "settings": [],
  "presets": [{ "name": "language currency block" }]
}
{% endschema %}
